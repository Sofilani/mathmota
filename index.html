 <!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>MathMota</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  <script src="https://unpkg.com/@lottiefiles/dotlottie-wc" type="module"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
  <style>
    #loadingScreen {
  display: none; /* fica oculto por padr√£o */
  flex-direction: column;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100vh;
  background: rgba(0,0,0,0.7); /* fundo escuro semi-transparente */
}

#loadingScreen.active {
  display: flex;
}

.loading-wrapper h1 {
  color: white;
  font-size: 2em;
  font-family: sans-serif;
  text-align: center;
}

/* Pontinhos animados */
.dots {
  display: inline-block;
  position: relative;
  width: 60px;
  height: 12px;
  margin-left: 10px;
}

.dot {
  position: absolute;
  width: 10px;
  height: 10px;
  background: #fff;
  border-radius: 50%;
  animation: move 1.5s infinite ease-in-out;
}

.dot:nth-child(1) { left: 0;   animation-delay: 0s; }
.dot:nth-child(2) { left: 20px; animation-delay: 0.2s; }
.dot:nth-child(3) { left: 40px; animation-delay: 0.4s; }

@keyframes move {
  0%   { transform: translateY(0); opacity: 0.5; }
  25%  { transform: translateY(-10px); opacity: 1; }
  50%  { transform: translateY(0); opacity: 0.5; }
  75%  { transform: translateY(10px); opacity: 1; }
  100% { transform: translateY(0); opacity: 0.5; }
}

    /* Tela de parab√©ns */
#rewardScreen {
  background: #FFD700; /* amarelo ouro no fundo */
  color: #000; /* texto preto para contraste */
}

/* Caixa do texto */
#rewardScreen .caixa {
  background: #FFF8B0; /* amarelo clarinho */
  padding: 20px;        /* menos espa√ßamento interno */
  border-radius: 20px; 
  box-shadow: 0px 4px 10px rgba(0,0,0,0.2);
  max-width: 5000px;     /* menor largura */
  margin: 400px auto 0; /* centraliza horizontalmente e empurra pra baixo */
  text-align: center;   /* mant√©m o texto centralizado */
}
.dots {
  display: inline-block;
  margin-left: 10px;
  position: relative;
  width: 60px; /* espa√ßo para o movimento */
  height: 12px;
}

.dot {
  position: absolute;
  width: 10px;
  height: 10px;
  background: #fff;
  border-radius: 50%;
  animation: move 1.5s infinite ease-in-out;
}

.dot:nth-child(1) { left: 0;   animation-delay: 0s; }
.dot:nth-child(2) { left: 20px; animation-delay: 0.2s; }
.dot:nth-child(3) { left: 40px; animation-delay: 0.4s; }

@keyframes move {
  0%   { transform: translateX(0); opacity: 0.5; }
  25%  { transform: translateX(10px); opacity: 1; }
  50%  { transform: translateX(0); opacity: 0.5; }
  75%  { transform: translateX(-10px); opacity: 1; }
  100% { transform: translateX(0); opacity: 0.5; }
}


    body {
      margin: 0;
      font-family: Arial, sans-serif;
      text-align: center;
      background: linear-gradient(135deg, #6a11cb, #2575fc);
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      overflow: hidden;
    }
     
   h1, h2 { 
  margin-bottom: 20px; 
}
.screen {
  display: none;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  animation: fadeIn 0.5s;
}
#screen1 {
  width: 100%;
  height: 100%;
}

/* Estilo espec√≠fico para a pergunta */
#pergunta {
  font-size: 2.5em; /* aumenta apenas o texto da pergunta */
  text-align: center;
  margin: 20px;
  line-height: 1.3;
}
    .active { display: flex; }
    input, select, button {
      font-size: 1.2em;
      padding: 10px;
      margin: 10px;
      border-radius: 8px;
      border: none;
    }
    .options button {
  padding: 40px 0;        /* altura maior do bot√£o */
  font-size: 2.5em;       /* aumenta o tamanho do texto/n√∫mero */
  border-radius: 20px;
  cursor: pointer;
  width: 100%;             /* ocupa toda a coluna da grid */
  max-width: 400px;        /* n√£o fica maior que 400px */
  transition: background 0.3s;
  color: #fff;
}
    .options button:hover, .options button:active { background: #2ecc71; }
    .selected { background: #e006a2 !important; }
    #timer { font-size: 2.5em; margin: 20px; }
    
   #grafico {
  max-width: 400px;
  max-height: 400px;
  background: #fff;
  border-radius: 10px;
  padding: 10px;
}
  .progresso {
  text-align: center;           /* centraliza o texto */
  color: gold;                  /* dourado */
  font-size: 1.8em;             /* aumenta o tamanho */
  font-weight: bold;            /* deixa destacado */
  text-shadow: 2px 2px 5px rgba(0,0,0,0.5); /* sombra para destacar */
  margin-bottom: 15px;
}

    .opcao-vermelho { background: #e74c3c; }
    .opcao-azul    { background: #3498db; }
    .opcao-amarelo { background: #f1c40f; color: #000; }
    .opcao-verde   { background: #2ecc71; }
    .correta { background: #35ba6c !important; color: #fff !important; }
    .errada  { background: #c0392b !important; color: #fff !important; }
    .options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      width: 90%;
      max-width: 600px;
    }
    .options button {
  padding: 50px;     /* aumenta o tamanho do bot√£o */
  font-size: 2.5em;  /* deixa os n√∫meros maiores */
  border-radius: 20px;
  cursor: pointer;
    }
    .desativado { background: #aec0c2 !important; color: #010101 !important; }
 
    /* ===== Teclado Virtual ===== */
    #keyboard {
     #keyboard {
    display: none; /* oculto por padr√£o */
    border: 1px solid #ccc;
    padding: 10px;
    background: #f9048f;
    width: fit-content;
    position: absolute; /* para poder posicionar perto do input */
    bottom: 20px;
    left: 20px;
    box-shadow: 0 4px 10px rgba(13, 13, 13, 0.2);
  }

  .row {
    display: flex;
    margin-bottom: 8px;
  }


  .key {
    display: inline-block;
    padding: 10px 15px;
    margin: 2px;
    background: #1aa8cf;
    border: 1px solid #9713f5;
    border-radius: 5px;
    cursor: pointer;
    user-select: none;
  }

  .key:hover {
    background: #1310d7;
  }

  .key-wide {
    flex: 1;
    text-align: center;
  }
}
#feedbackMsg {
  text-align: center;     
  margin-top: 50px;
  font-size: 2em;         
  color: #fff;           
}

    @keyframes fadeIn { from {opacity:0} to {opacity:1} }
  </style>
</head>
<body>

<!-- Tela 1 -->
<div class="screen active" id="screen1">
  <dotlottie-wc 
    src="{{ url_for('static', filename='mathrosto.lottie') }}" 
    background="transparent"
    speed="1"
    style="width: 2500px; height: 2420px;"
    loop autoplay
  ></dotlottie-wc>
  </div>

 <script>
  const tela1 = document.getElementById("screen1");


  // Clique no PC
  tela1.addEventListener("click", () => {
    mostrarTelaMenu();
  });
</script>
<div class="screen" id="menuScreen">
  <h1>Quem √© voc√™?</h1>
  <button onclick="entrarAluno()">Aluno</button>
  <button onclick="entrarProfessor()">Professor</button>
</div>

  
<!-- Tela 2: Nome e Ano -->
<div class="screen" id="screen2">
  <h1>Digite seu nome e selecione o ano escolar</h1>
  <input type="text" id="nome" placeholder="Seu nome" readonly>
  <select id="ano">
    <option value="">Escolha o ano</option>
    <option value="3¬∫ ano">3¬∫ ano</option>
    <option value="4¬∫ ano">4¬∫ ano</option>
    <option value="5¬∫ ano">5¬∫ ano</option>
    <option value="6¬∫ ano">6¬∫ ano</option>
    <option value="2¬∫ ano">2¬∫ ano t√©cnico</option>
  </select>
  <button onclick="iniciarQuiz(); reset()">Continuar</button>

  <!-- Teclado Virtual -->
  <div id="keyboard">
    <div class="row">
      <span class="key">Q</span><span class="key">W</span><span class="key">E</span><span class="key">R</span><span class="key">T</span>
      <span class="key">Y</span><span class="key">U</span><span class="key">I</span><span class="key">O</span><span class="key">P</span>
    </div>
    <div class="row">
      <span class="key">A</span><span class="key">S</span><span class="key">D</span><span class="key">F</span><span class="key">G</span>
      <span class="key">H</span><span class="key">J</span><span class="key">K</span><span class="key">L</span>
    </div>
    <div class="row">
      <span class="key">Z</span><span class="key">X</span><span class="key">C</span><span class="key">V</span><span class="key">B</span>
      <span class="key">N</span><span class="key">M</span>
      <span class="key key-wide" data-action="backspace">‚å´</span>
    </div>
    <div class="row">
      <span class="key key-wide" data-action="space">Espa√ßo</span>
    </div>
  </div>
</div>

<div class="screen" id="senhaScreen">
  <h1>Digite a senha do professor</h1>
  <input type="password" id="senhaProfessor" placeholder="Senha">
  <button onclick="validarSenha()">Entrar</button>
  <p id="erroSenha" style="color:red; display:none;">Senha incorreta!</p>
</div>
<div class="screen" id="anoProfessorScreen">
  <h1>Selecione o ano</h1>
  <select id="anoProfessor">
    <option value="">Escolha o ano</option>
    <option value="3¬∫ ano">3¬∫ ano</option>
    <option value="4¬∫ ano">4¬∫ ano</option>
    <option value="5¬∫ ano">5¬∫ ano</option>
    <option value="6¬∫ ano">6¬∫ ano</option>
    <option value="2¬∫ ano">2¬∫ ano t√©cnico</option>
  </select>
  <button onclick="mostrarParticipantes()">Continuar</button>
</div>
<div class="screen" id="participantesScreen">
  <h1>Participantes</h1>
  <ul id="listaParticipantes"></ul>
</div>
<div class="screen" id="relatorioScreen">
  <h1>Relat√≥rio</h1>
  <div id="dadosRelatorio"></div>
  <button onclick="voltarParticipantes()">Voltar</button>
</div>

<!-- Outras Telas -->
<div class="screen" id="loadingScreen">
  <div class="loading-wrapper">
    <h1>
      Preparando para as perguntas
      <span class="dots">
        <span class="dot"></span>
        <span class="dot"></span>
        <span class="dot"></span>
      </span>
    </h1>
  </div>
  </div>

<div class = "screen" id="questionScreen">
<h3 id="progressoPergunta"></h3>
  <h2 id="pergunta"></h2>
  <div class="options">
    <button onclick="responder(0)" id="opt0" class="opcao-vermelho"></button>
    <button onclick="responder(1)" id="opt1" class="opcao-azul"></button>
    <button onclick="responder(2)" id="opt2" class="opcao-amarelo"></button>
    <button onclick="responder(3)" id="opt3" class="opcao-verde"></button>
  </div>
  

  <!-- Barra de tempo rosa -->
  <div id="timerBar" style="width: 80%; height: 20px; background: #ddd; border-radius: 15px; margin: 20px auto;">
    <div id="preenchimentoBarra" style="width: 100%; height: 100%; background: #ff69b4; border-radius: 15px;"></div>
  </div>
  </div>
  



<div class="screen" id="feedbackScreen">
  <h1 id="feedbackMsg"></h1>
 <dotlottie-wc id="imgErro"
    src="{{ url_for('static', filename='matherro.lottie') }}" 
    background="transparent"
    speed="1"
    style="width: 2387px; height: 2307px; position: relative; top: -100px;"
    loop autoplay
  ></dotlottie-wc>
 <dotlottie-wc id="imgAcerto"
    src="{{ url_for('static', filename='Mathacerto.lottie') }}" 
    background="transparent"
    speed="1"
    style="width: 2387px; height: 2307px; position: relative; top: -100px;"
    loop autoplay
  ></dotlottie-wc>
  <button onclick="proximaPergunta()" style="
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            padding: 10px 20px;
            font-size: 18px;
            font-weight: bold;
            color: white;
            background-color: rgba(0, 0, 0, 0.6);
            border: none;
            border-radius: 8px;
            cursor: pointer;
          ">Pr√≥xima</button>
</div>

<div class="screen" id="reportScreen">
  <h2 id="resumo"></h2>
  <canvas id="grafico"></canvas>
  <button onclick="mostrarRecompensa()">Ver Surpresa</button>
</div>
<div class="screen" id="rewardScreen">
  <div class="caixa">
    <h1>Parab√©ns, <span id="userName"></span>! üéâ</h1>
    <p>Voc√™ acertou tudinho! Aqui est√° sua surpresa: üéÅ</p>
  </div>
</div>

<script>
  const perguntas3 = [
    { q: "Quanto √© 348 + 126?", options: ["464", "484", "474", "494"], correct: 2, category: "Opera√ß√µes com N√∫meros Naturais"},
    { q: "Quanto √© 6 √ó 4?", options: ["20", "18", "24", "28"], correct: 2, category: "Opera√ß√µes com N√∫meros Naturais" },
    { q: "Quanto √© 9 √ó 3?", options: ["21", "24", "27", "30"], correct: 2, category: "Opera√ß√µes com N√∫meros Naturais" },
    { q: "Quanto √© 10 √∑ 2?", options: ["2", "5", "4", "6"], correct: 1, category: "Opera√ß√µes com N√∫meros Naturais" },
    { q: "O n√∫mero que vem depois de 699 √©:", options: ["600 ", " 700", " 799", "701"], correct: 1, category: "Sistema de Numera√ß√£o Decimal" },
    { q: "Qual √© o valor posicional do algarismo 7 no n√∫mero 572?", options: ["7 unidades", "7 dezenas", "7 centenas", "70 centenas"], correct: 1, category: "     Sistema de Numera√ß√£o Decimal" },
    { q: "Qual √© a decomposi√ß√£o correta do n√∫mero 736?", options: ["700 + 30 + 6", "70 + 300 + 6", "700 + 36", "7 + 36"], correct: 0, category: "Sistema de Numera√ß√£o Decimal" },
    { q: "Qual √© o n√∫mero que tem 6 centenas, 2 dezenas e 5 unidades?", options: ["625", "652", "265", "562"], correct: 0, category: "Sistema de Numera√ß√£o Decimal" }
  ];

  const perguntas4 = [
    { q: "Quanto √© 325 + 478?", options: ["703", "803", "793", "813"], correct: 2, category: "Opera√ß√£o com N√∫meros Naturais" },
    { q: "Qual √© o resultado de 942 ‚Äì 586?", options: ["356", "376", "366", "386"], correct: 0, category: "Opera√ß√£o com N√∫meros Naturais" },
    { q: "Se Jo√£o tinha 250 reais e gastou 175, com quanto ele ficou?", options: ["65", "75", "70", "85"], correct: 1, category: "Opera√ß√£o com N√∫meros Naturais" },
    { q: "Calcule 36 √ó 4:", options: ["124", "144", "134", "154"], correct: 1, category: "Opera√ß√£o com N√∫meros Naturais" },
    { q: "Se uma barra de chocolate foi dividida em 8 partes iguais e Maria comeu 3, qual fra√ß√£o ela comeu?", options: ["3/4", "5/8", "3/8", "8/3"], correct: 2, category: "Quest√µes de Fra√ß√µes" },
    { q: "Se voc√™ tem 3 fatias de 3 iguais, qual fra√ß√£o voc√™ tem?", options: [" 3/3", "2/3", " 1/3", "1/2"], correct: 0, category: "Quest√µes de Fra√ß√µes" },
    { q: "Qual fra√ß√£o representa ‚Äúum ter√ßo de um bolo‚Äù?", options: ["1/2", "1/4", "1/3", "1/6"], correct: 2, category: "Quest√µes de Fra√ß√µes" },
    { q: "Qual fra√ß√£o √© equivalente a 3/6?", options: ["1/2", "2/3", " 1/3", "3/3"], correct: 0, category: "Quest√µes de Fra√ß√µes" }
  ];

  const perguntas5 = [
    { q: "Qual √© o valor de 125 √ó 4?", options: ["450", "520", " 500", "525"], correct: 2, category: "Opera√ß√µes com N√∫meros Naturais" },
    { q: "Calcule 56 √ó 6:", options: ["326", "346", "336", "356"], correct: 2, category: "Opera√ß√µes com N√∫meros Naturais" },
    { q: "Uma escola tem 432 alunos e quer dividir igualmente em 8 turmas. Quantos alunos em cada turma?", options: ["52", "54", "53", "55"], correct: 1, category: "Opera√ß√µes com N√∫meros Naturais" },
    { q: "Calcule a divis√£o 48 √∑ 6:", options: ["6", "8", "7", "9"], correct: 1, category: "Opera√ß√µes com N√∫meros Naturais" },
    { q: "Complete 2,3 + 1,4 = ?", options: ["3,6", "3,8", "3,7", "3,9"], correct: 2, category: "N√∫mero Decimal" },
    { q: "Qual n√∫mero decimal representa meio?", options: [" 0,05", "5,0", "0,5", "0,50"], correct: 2, category: "N√∫mero Decimal" },
    { q: "Escreva em decimal: 3 unidades e 2 d√©cimos", options: ["3,02", "32", " 3,2", "0,32"], correct: 2, category: "N√∫mero Decimal"},
    { q: "Complete  4,5 ‚Äì 2,3= ?", options: ["1,9", "2,2", "2,1", " 2,3"], correct: 2, category: "N√∫mero Decimal" }
  ];

  const perguntas6 = [
    { q: "Calcule a multiplica√ß√£o 76 √ó 9", options: ["674", "694", "684", " 704"], correct: 2, category: " Opera√ß√µes com N√∫meros Naturais" },
    { q: "Calcule a Divis√£o  1.152 √∑ 8", options: ["142", "146", "148", "144"], correct: 3, category: " Opera√ß√µes com N√∫meros Naturais" },
    { q: "Multiplique 245 √ó 5:", options: ["1.125", "1.325", "1.425", " 1.225"], correct: 3, category: " Opera√ß√µes com N√∫meros Naturais" },
    { q: "Uma escola tem 1.080 alunos e quer dividir igualmente em 12 turmas. Quantos alunos em cada turma?", options: ["85", "90", "95", "100"], correct: 1, category: " Opera√ß√µes com N√∫meros Naturais" },
    { q: "Qual √© 10% de 200?", options: ["10", "15", "20", "25"], correct: 2, category: "   Porcentagem " },
    { q: "Um produto custa R$ 150,00 e teve 20% de desconto. Quanto √© o desconto?", options: [" R$ 25", " R$ 35", "R$ 39", "R$ 30"], correct: 3, category: " Porcentagem" },
    { q: "Qual √© 50% de 90?", options: ["40", "50", "45", "55"], correct: 2, category: "Porcentagem" },
    { q: "Se uma nota tem 80 quest√µes e voc√™ acertou 90% delas, quantas quest√µes acertou?", options: ["70", "72", "75", "80"], correct: 1, category: " Porcentagem" }
  ];

  const perguntas2 = [
    { q: "Quanto vale cos(0¬∞)?", options: ["0", "1/2", "90", "1"], correct: 3,  category: " Trigonometria"},
    { q: "Qual √© a soma dos √¢ngulos internos de um quadril√°tero?", options: ["180¬∞", "270¬∞", "360¬∞", "540¬∞"], correct: 2, category: " Pol√≠gonos" },
    { q: "Quanto vale sin(30¬∞)?", options: ["0", "1/2", "1", "30"], correct: 1, category: " Trigonometria" },
    { q: "Um hex√°gono regular tem todos os √¢ngulos iguais.Qual √© a medida de cada √¢ngulo interno?", options: ["100¬∞", "120¬∞", "135¬∞", "140¬∞"], correct: 1, category: " Pol√≠gonos" },
    { q: "Quanto vale sin(0¬∞)?", options: ["1/2", "0", "1", "3/4"], correct: 1, category: "   Trigonometria " },
    { q: "Quantos diagonais tem um pent√°gono?", options: ["31", "5", "70", "1"], correct: 1, category: " Pol√≠gonos" },
    { q: "Se cos (ùúÉ) = 1/2 e Œ∏ est√° no primeiro quadrante, qual √© o valor de ùúÉ?", options: ["30¬∞", "45¬∞", "60¬∞", "90¬∞"], correct: 0, category: " Trigonmometria" },
    { q: "Seja um tri√¢ngulo ret√¢ngulo em que um dos √¢ngulos agudos mede 30¬∞ e a hipotenusa mede 10.Qual √© o valor do cateto oposto a esse √¢ngulo de 30¬∞?", options: ["3", "4", "5", "6"], correct: 2, category: " Trigonometria" }
  ];

  let perguntas = []; 
  let resultados = [];
  let nome = "";
  let ano = "";
  let indice = 0;
  let acertos = 0;
  let tempo = 10;
  let timerInterval = null; 
  
  // === Teclado Virtual ===
  const input = document.getElementById("nome");
  const keyboard = document.getElementById("keyboard");

  input.addEventListener("click", (e) => {
    e.stopPropagation();
    keyboard.style.display = "block";
  });

  keyboard.addEventListener("click", (e) => {
    e.stopPropagation();
  });

  document.addEventListener("click", () => {
    keyboard.style.display = "none";
  });

  document.querySelectorAll(".key").forEach(key => {
    key.addEventListener("click", () => {
      const action = key.dataset.action;
      if (action === "backspace") {
        input.value = input.value.slice(0, -1);
      } else if (action === "space") {
        input.value += " ";
      } else {
        input.value += key.textContent;
      }
    });
  });

  function mostrarTela2() {
    document.getElementById('screen1').classList.remove('active');
    document.getElementById('screen2').classList.add('active');
  }
  // === Fluxo Aluno/Professor ===
function mostrarTelaMenu() {
  trocarTela('menuScreen');
}

function entrarAluno() {
  trocarTela('screen2'); // j√° existente
}

function entrarProfessor() {
  trocarTela('senhaScreen');
}

function validarSenha() {
  const senha = document.getElementById('senhaProfessor').value;
  if (senha === "123") { // senha fixa
    document.getElementById('erroSenha').style.display = "none";
    trocarTela('anoProfessorScreen');
  } else {
    document.getElementById('erroSenha').style.display = "block";
  }
}

function mostrarParticipantes() {
  const anoSel = document.getElementById('anoProfessor').value;
  if (!anoSel) return alert("Selecione um ano!");

  // busca no backend os alunos/resultados desse ano
  fetch(`/resultados/${anoSel}`)
    .then(res => res.json())
    .then(dados => {
      const lista = document.getElementById('listaParticipantes');
      lista.innerHTML = "";

      // vamos agrupar os resultados por nome de aluno
      const alunos = {};
      dados.forEach(([nome, acertos, erros, data]) => {
        if (!alunos[nome]) alunos[nome] = [];
        alunos[nome].push({ acertos, erros, data });
      });

      // cria a lista de alunos
      Object.keys(alunos).forEach(nome => {
        const li = document.createElement("li");
        li.textContent = nome;
        li.style.cursor = "pointer";
        li.onclick = () => mostrarRelatorioProfessor(nome, alunos[nome]); 
        lista.appendChild(li);
      });
    });

  trocarTela('participantesScreen');
}


function mostrarRelatorioProfessor(nome, resultados) {
  trocarTela('reportScreen');
 

  // Calcula acertos e erros totais
  const acertos = resultados.reduce((sum, r) => sum + r.acertos, 0);
  const erros = resultados.reduce((sum, r) => sum + (!r.acertou ? 1 : 0), 0);

  // Atualiza resumo
  document.getElementById('resumo').textContent =
    `${nome} - Acertos: ${acertos}/${resultados.length}`;

  // Calcula categorias
  let categorias = {};
  resultados.forEach(r => {
    if (!categorias[r.categoria]) {
      categorias[r.categoria] = { total: 0, acertos: 0, erros: 0 };
    }
    categorias[r.categoria].total++;
    if (r.acertou) categorias[r.categoria].acertos++;
    else categorias[r.categoria].erros++;
  });

  // Fun√ß√£o para criar painel de acertos/erros
  function criarPainel(titulo, cor, dados, tipo) {
    let painel = `<div style="padding:10px;border-radius:20px;width:200px;margin:10px;">
                    <h3 style="margin:0;background-color:${cor};border-radius:15px;padding:5px;text-align:center;color:white;">${titulo}</h3>`;
    for (let cat in dados) {
      let porcento = ((tipo === 'acertos' ? dados[cat].acertos : dados[cat].erros) / dados[cat].total * 100).toFixed(1);
      painel += `<p>${cat}: ${porcento}%</p>`;
    }
    painel += `</div>`;
    return painel;
  }

  const painelAcertos = criarPainel('Acertos', '#3498db', categorias, 'acertos');
  const painelErros = criarPainel('Erros', '#e74c3c', categorias, 'erros');

  // Pior categoria
  let piorCategoria = null;
  let maiorErro = 0;
  for (let cat in categorias) {
    let porcentoErro = (categorias[cat].erros / categorias[cat].total) * 100;
    if (porcentoErro > maiorErro) {
      maiorErro = porcentoErro;
      piorCategoria = cat;
    }
  }

  const painelMelhoria = `<div style="padding:10px;border-radius:20px;width:300px;margin:10px;">
                            <h3 style="margin:0;background-color:#2ecc71;border-radius:15px;padding:5px;text-align:center;color:white;">Pontos de melhoria:</h3>
                            <p>O aluno <b>${nome}</b> apresentou mais dificuldades em <b>${piorCategoria}</b>, 
                            por consequ√™ncia √© indicado prestar apoio e mais aten√ß√£o em atividades relacionadas a <b>${piorCategoria}</b>.</p>
                          </div>`;

  // Limpar conte√∫do anterior e manter canvas e bot√£o
  const report = document.getElementById('reportScreen');
  report.innerHTML = `<h2 id="resumo"></h2>
                      <div id="containerPrincipal" style="display:flex; justify-content:center; align-items:flex-start; gap:40px; margin-top:20px;"></div>
                      <canvas id="grafico"></canvas>
                      <button style="display:none;">Ver Surpresa</button>`;

  document.getElementById('resumo').textContent =
    `${nome} - Acertos: ${acertos}/${resultados.length}`;

  // Criar container principal e colunas
  const containerPrincipal = document.getElementById('containerPrincipal');

  // Esquerda: Acertos e Erros empilhados
  const containerEsquerda = document.createElement('div');
  containerEsquerda.style.display = 'flex';
  containerEsquerda.style.flexDirection = 'column';
  containerEsquerda.style.gap = '20px';
  containerEsquerda.innerHTML = painelAcertos + painelErros;

  // Centro: gr√°fico
  const containerCentral = document.createElement('div');
  containerCentral.style.display = 'flex';
  containerCentral.style.justifyContent = 'center';
  containerCentral.style.alignItems = 'center';
  containerCentral.style.flexDirection = 'column';
  containerCentral.appendChild(document.getElementById('grafico'));

  // Direita: Pontos de melhoria
  const containerDireita = document.createElement('div');
  containerDireita.style.display = 'flex';
  containerDireita.style.flexDirection = 'column';
  containerDireita.style.gap = '20px';
  containerDireita.innerHTML = painelMelhoria;

  // Adicionar colunas ao container principal
  containerPrincipal.appendChild(containerEsquerda);
  containerPrincipal.appendChild(containerCentral);
  containerPrincipal.appendChild(containerDireita);

  // Criar gr√°fico
  const ctx = document.getElementById('grafico').getContext('2d');
  new Chart(ctx, {
    type: 'pie',
    data: {
      labels: ['Acertos', 'Erros'],
      datasets: [{
        data: [acertos, erros],
        backgroundColor: ['#3498db', '#e74c3c']
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { position: 'bottom' }
      }
    }
  });
}


function voltarParticipantes() {
  trocarTela('participantesScreen');
}


  function iniciarQuiz() {
    nome = document.getElementById('nome').value;
    ano = document.getElementById('ano').value;
    if (!nome || !ano) return alert("Preencha tudo!");

    if (ano === "3¬∫ ano") perguntas = perguntas3;
    if (ano === "4¬∫ ano") perguntas = perguntas4;
    if (ano === "5¬∫ ano") perguntas = perguntas5;
    if (ano === "6¬∫ ano") perguntas = perguntas6;
    if (ano === "2¬∫ ano") perguntas = perguntas2;

    trocarTela('loadingScreen');
    setTimeout(() => {
      indice = 0;
      acertos = 0;
      mostrarPergunta();
    }, 2000);
  }

 function mostrarPergunta() {
  trocarTela('questionScreen');
  const p = perguntas[indice];
  document.getElementById('progressoPergunta').textContent = 
      `Pergunta ${indice + 1} de ${perguntas.length}`;
  document.getElementById('pergunta').textContent = p.q;

  p.options.forEach((op, i) => {
    const botao = document.getElementById(`opt${i}`);
    botao.textContent = op;
    botao.classList.remove('correta', 'errada', 'desativado');

    if (i === 0) botao.className = 'opcao-vermelho';
    if (i === 1) botao.className = 'opcao-azul';
    if (i === 2) botao.className = 'opcao-amarelo';
    if (i === 3) botao.className = 'opcao-verde';
  });

  // ===== Inicializa a barra =====
  clearInterval(timerInterval);
  let tempoTotal = 10000;          
  let tempoRestante = tempoTotal;
  let barra = document.getElementById('preenchimentoBarra');
  barra.style.width = '100%'; // come√ßa cheia

  timerInterval = setInterval(() => {
    tempoRestante -= 20;
    if (tempoRestante < 0) tempoRestante = 0;

    let porcentagem = (tempoRestante / tempoTotal) * 100;
    barra.style.width = porcentagem + '%';

    // Gradiente verde -> amarelo -> vermelho
    let r, g, b;
    if (porcentagem > 50) {
      let t = (100 - porcentagem) / 50;
      r = Math.round(46 + t * (241 - 46));
      g = Math.round(204 + t * (196 - 204));
      b = Math.round(113 + t * (15 - 113));
    } else {
      let t = (50 - porcentagem) / 50;
      r = Math.round(241 + t * (231 - 241));
      g = Math.round(196 + t * (76 - 196));
      b = Math.round(15 + t * (60 - 15));
    }
    barra.style.background = `rgb(${r},${g},${b})`;

    if (tempoRestante <= 0) {
      clearInterval(timerInterval);
      verificarResposta(-1);
    }
  }, 20);
}


  function trocarTela(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  function responder(i) {
    clearInterval(timerInterval);
    verificarResposta(i);
  }

  function verificarResposta(i) {
    const correta = perguntas[indice].correct;
    const botoes = document.querySelectorAll('.options button');

    botoes.forEach(b => {
      b.classList.remove('correta', 'errada', 'desativado');
    });

    resultados.push({ categoria: perguntas[indice].category, acertou: i === correta });

    if (i === correta) {
      acertos++;
      socket.emit('acertou'); 
       // üéâ Dispara o confete
    confetti({
      particleCount: 100,
      spread: 70,
      origin: { y: 0.6 }
    });
      botoes.forEach((b, index) => {
        if (index === correta) {
          b.classList.add('correta');
        } else {
          b.classList.add('desativado');
        }
      });
    } else {
      socket.emit('errou'); 
      botoes.forEach((b, index) => {
        if (index === i) {
          b.classList.add('errada');
        } else if (index === correta) {
          b.classList.add('correta');
        } else {
          b.classList.add('desativado');
        }
      });
    }
    setTimeout(() => {
      if (i === correta) {
        document.getElementById('feedbackMsg').textContent = "Acertou!";
        document.getElementById('imgErro').style.display = 'none';
        document.getElementById('imgAcerto').style.display = 'block';
      } else {
        document.getElementById('imgErro').style.display = "block"; 
        document.getElementById('imgAcerto').style.display = 'none';
        document.getElementById('feedbackMsg').textContent = "Essa foi uma boa tentativa! Vamos tentar de novo?";
      }
      trocarTela('feedbackScreen');
    }, 1000);
  }

  function proximaPergunta() {
    indice++;
    if (indice < perguntas.length) {
      mostrarPergunta();
    } else {
      mostrarRelatorio();
      
    }
  }

function mostrarRelatorio() {
  trocarTela('reportScreen');
  

  const erros = perguntas.length - acertos;
  enviarResultado(nome, ano, acertos, erros);

  // Atualizar resumo
  document.getElementById('resumo').textContent =
    `${nome} (${ano}) - Acertos: ${acertos}/${perguntas.length}`;

  // Calcular categorias
  let categorias = {};
  resultados.forEach(r => {
    if (!categorias[r.categoria]) {
      categorias[r.categoria] = { total: 0, acertos: 0, erros: 0 };
    }
    categorias[r.categoria].total++;
    if (r.acertou) categorias[r.categoria].acertos++;
    else categorias[r.categoria].erros++;
    
  });

  // Fun√ß√£o para criar painel
  function criarPainel(titulo, cor, dados, tipo) {
    let painel = `<div style="padding:10px;border-radius:20px;width:200px;margin:10px;">
                    <h3 style="margin:0;background-color:${cor};border-radius:15px;padding:5px;text-align:center;color:white;">${titulo}</h3>`;
    for (let cat in dados) {
      let porcento = ((tipo === 'acertos' ? dados[cat].acertos : dados[cat].erros) / dados[cat].total * 100).toFixed(1);
      painel += `<p>${cat}: ${porcento}%</p>`;
    }
    painel += `</div>`;
    return painel;
  }

  const painelAcertos = criarPainel('Acertos', '#3498db', categorias, 'acertos');
  const painelErros = criarPainel('Erros', '#e74c3c', categorias, 'erros');

  // Pior categoria
  let piorCategoria = null;
  let maiorErro = 0;
  for (let cat in categorias) {
    let porcentoErro = (categorias[cat].erros / categorias[cat].total) * 100;
    if (porcentoErro > maiorErro) {
      maiorErro = porcentoErro;
      piorCategoria = cat;
    }
  }

  const painelMelhoria = `<div style="padding:10px;border-radius:20px;width:300px;margin:10px;">
                            <h3 style="margin:0;background-color:#2ecc71;border-radius:15px;padding:5px;text-align:center;color:white;">Pontos de melhoria:</h3>
                            <p>O aluno <b>${nome}</b> apresentou mais dificuldades em <b>${piorCategoria}</b>, 
                            por consequ√™ncia √© indicado prestar apoio e mais aten√ß√£o em atividades relacionadas a <b>${piorCategoria}</b>.</p>
                          </div>`;

  // Limpar conte√∫do anterior e manter canvas e bot√£o
  const report = document.getElementById('reportScreen');
  report.innerHTML = `<h2 id="resumo"></h2>
                      <div id="containerPrincipal" style="display:flex; justify-content:center; align-items:flex-start; gap:40px; margin-top:20px;"></div>
                      <canvas id="grafico"></canvas>
                      <button onclick="mostrarRecompensa()">Ver Surpresa</button>`;

  document.getElementById('resumo').textContent =
    `${nome} (${ano}) - Acertos: ${acertos}/${perguntas.length}`;

  // Criar container principal e colunas
  const containerPrincipal = document.getElementById('containerPrincipal');

  // Esquerda: Acertos e Erros empilhados
  const containerEsquerda = document.createElement('div');
  containerEsquerda.style.display = 'flex';
  containerEsquerda.style.flexDirection = 'column';
  containerEsquerda.style.gap = '20px';
  containerEsquerda.innerHTML = painelAcertos + painelErros;

  // Centro: gr√°fico
  const containerCentral = document.createElement('div');
  containerCentral.style.display = 'flex';
  containerCentral.style.justifyContent = 'center';
  containerCentral.style.alignItems = 'center';
  containerCentral.style.flexDirection = 'column';
  containerCentral.appendChild(document.getElementById('grafico'));

  // Direita: Pontos de melhoria
  const containerDireita = document.createElement('div');
  containerDireita.style.display = 'flex';
  containerDireita.style.flexDirection = 'column';
  containerDireita.style.gap = '20px';
  containerDireita.innerHTML = painelMelhoria;

  // Adicionar colunas ao container principal
  containerPrincipal.appendChild(containerEsquerda);
  containerPrincipal.appendChild(containerCentral);
  containerPrincipal.appendChild(containerDireita);

  // Criar gr√°fico
  const ctx = document.getElementById('grafico').getContext('2d');
  new Chart(ctx, {
    type: 'pie',
    data: {
      labels: ['Acertos', 'Erros'],
      datasets: [{
        data: [acertos, erros],
        backgroundColor: ['#3498db', '#e74c3c']
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { position: 'bottom' }
      }
    }
  });

  // Mostrar bot√£o apenas se acertos >= 6
  const botao = document.querySelector('#reportScreen button');
  botao.style.display = acertos >= 6 ? 'inline-block' : 'none';
}



  function mostrarRecompensa() {
    socket.emit('recompensa');
    trocarTela('rewardScreen');
    document.getElementById('userName').textContent = nome;
  }

  function enviarResultado(nome, ano, acertos, erros) {
  fetch("/salvar_resultado", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    nome: nomeJogador,
    ano: anoJogador,
    resultados: resultados  
  })
});

}

  const socket = io('http://localhost:5001');
  console.log("O script est√° rodando!");

  socket.on('botao', data => {
    console.log('Evento de bot√£o recebido! Dados:', data);
    const botao = data.botao.replace('BTN','') - 1;
    responder(botao);
  });

  function reset() {
    socket.emit("reset");
  }
  
  
</script>
</body>
</html>
